import jax.numpy as jnp
import numpy as np
import numpy.testing as npt
import pytest
from admp.multipole import convert_cart2harm


class TestMultipoleGeometry:
    @pytest.mark.parametrize(
        "theta, expected",
        [
            (
                jnp.array(
                    [
                        [
                            -1.0614,
                            0.0,
                            0.0,
                            -0.23671684,
                            0.0452889,
                            0.026121,
                            -0.0714102,
                            0.0,
                            0.0,
                            0.0,
                        ],
                        [0.5307, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                        [0.5307, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                        [
                            -1.0614,
                            0.0,
                            0.0,
                            -0.23671684,
                            0.0452889,
                            0.026121,
                            -0.0714102,
                            0.0,
                            0.0,
                            0.0,
                        ],
                        [0.5307, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                        [0.5307, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                    ]
                ),
                jnp.array(
                    [
                        [
                            -1.0614,
                            -0.23671684,
                            0.0,
                            0.0,
                            -0.0714102,
                            0.0,
                            0.0,
                            0.01106659,
                            0.0,
                        ],
                        [0.5307, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                        [0.5307, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                        [
                            -1.0614,
                            -0.23671684,
                            0.0,
                            0.0,
                            -0.0714102,
                            0.0,
                            0.0,
                            0.01106659,
                            0.0,
                        ],
                        [0.5307, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                        [0.5307, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
                    ]
                ),
            )
        ],
    )
    def test_convert_cart2harm(self, theta, expected):

        Q = convert_cart2harm(theta, 2)
        npt.assert_allclose(Q, expected, rtol=1e-6)
